<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <title>Orbited: Using Python With Orbited Tutorial</title>
  <link rel="stylesheet" href="../css/tutorials_common.css">
</head>
<body>
  <h1>Using Python with Orbited</h1>
  <div class="toc">
    <h2>Table of Contents</h2>
    <ul>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#tutorial">Tutorial</a></li>
      <li><a href="#conclusion">Conclusion</a></li>    
    </ul>
  </div>
  
  <div id="introduction">
    <h2>Introduction</h2>
    <p>This tutorial will demonstrate how the Orbited client API interacts with the Orbited daemon. The great thing about Python is the interpreter, and Orbited is no special case. By the end of this tutorial you will have sent real-time events from a Python interpreter to specific browser windows.</p>
  </div>
  
  <div id="prerequisities">
    <h2>Prerequisites</h2>
    
    <ol>
      <li>
        <h3>Orbited</h3>
        <p>This tutorial assumes you have already installed Orbited. If you haven’t then check out the tutorial on <a href="installation.html">Installing Orbited</a>.</p>
      </li>
      <li>
        <h3>PyOrbited</h3>
        <p>PyOrbited is a library of Python implementations of the Orbited client API. It currently consists of a basic socket based implementation, a twisted implementation, and a pyevent/libevent implementation. For our purposes we only need the basic implementation, but all three come with PyOrbited. To install the library simply run:</p>
        
        <pre><code class="commandline">easy_install pyorbited</code></pre>
      </li>
      <li>
        <h3>SimpleJSON</h3>
        <p>SimpleJSON is Python library for encoding and decoding the JSON format. To install it run:</p>
        
        <pre><code class="commandline">easy_install simplejson</code></pre>
      </li>
    </ol>
  </div>
  <div id="tutorial">
    <h2>Tutorial</h2>
    <p>First off, we need to start up the Orbited daemon. This can be done by running the command <tt>orbited</tt> in a console or command window. You should see a note that a configuration file wasn’t found. By default Orbited looks for the default config file <tt>orbited.cfg</tt> in the directory where you run the command. You can also specify a config file as the first argument when running the daemon. The console output should look like this (with a few more messages):</p>
    
    <pre><code class="console">orbited.cfg could not be found. Using default configuration
2007-10-20 05:12:45,705 - Router - INFO - register_static, /_/admin_screen/static/, [...]
2007-10-20 05:12:45,774 - OrbitedDaemon - INFO - Listening on port 9000</code></pre>
    
    <p>This indicates that the Orbited daemon is listening for incoming HTTP connections on port 8000 and incoming orbit connections on port 9000.</p>
    
    <p>Now open a browser window and visit the URL <a href="http://localhost:8000/_/about">http://localhost:8000/_/about</a>. This page should display something similar to the following:</p>
    
    <div class="browser">
      <h1>Orbited 0.2.0</h1> 
      <p>
        Python 2.5 (r25:51908, Sep 19 2006, 09:52:17)
        [MSC v.1310 32 bit (Intel)] on win32 
    </p> 
    </div>
    
    <p>This indicates that you have successfully made contact with the Orbited server. Now point your browser to the URL <a href="http://localhost:8000/demo?user=user&amp;session=0&amp;transport=raw">http://localhost:8000/demo?user=user&amp;session=0&amp;transport=raw</a>. This page will seem to hang and you’ll see a Loading message in your browser’s status. If you visited the URL in a browser window that had a previous page, you may still see the contents of that previous page. Don’t worry though, this is normal behavior.</p>
    
    <p>The next step is to open a Python interpreter. Next execute the commands:</p>
    <pre style="border: 1px solid red; padding: 4px;"><code class="python_interpter">>>> import pyorbited.simple
>>> client = pyorbited.simple.Client()
>>> user_key = "user, 0, /demo"
>>> client.event( [ user_key ], "Hello from python!&lt;br>", False)</code></pre>
   <font color=red> The above step is temoporarily broken for Orbited 0.2.0. Use the following instead:</font>
    <pre style="border: 1px solid black; padding: 4px;"><code class="python_interpreter">>>> import pyorbited.simple
>>> client = pyorbited.simple.Client()
>>> user_key = "user, 0, /demo"
>>> headers = "HTTP/1.0 200 OK\r\nContent-type: text/html\r\n\r\n"
>>> client.event([user_key], headers, False)
>>> client.event([user_key], "<span></span>" * 100, False) # for Safari
>>> client.event([user_key], "Hello from Python!&lt;br&gt;", False)
>>> client.event([user_key], "Hello &lt;b&gt;again&lt;/b&gt;&lt;br&gt;", False)</code></pre>
    <p>The first two lines import the Orbited client API and create a client object. The next line is the user_key we use to identify the browser window we want to communicate with. If you recall, we accessed <nobr><tt>/demo?user=user&amp;session=0&amp;transport=raw</tt></nobr>. This indicates that the location we are sending is <tt>/demo</tt> and the username is <tt>user</tt>, and the session key is <tt>0</tt>. Therefore the unique key identifying that browser window is <tt>"user, 0, /demo"</tt>. The last line is where we actually send the event. The client.event function takes 2 arguments and a third optional argument. The first argument is a list of unique user keys that determine the recipients of the event. The second argument is the event data itself, and the third argument which we specify as false determines wether we wish to encode the data in the JSON format. We want to send raw HTML so we don’t encode the data.</p>
    
    <p>At this point you can try sending events to user keys that you know don’t exist and see what sort of response you get. You can also send events to multiple open browsers simply by including each recipient user key in the first argument to the event function.</p>
  </div>
  <div id="conclusion">
    <h2>Conclusion</h2>
    <p>Now you have some idea of how orbit works. Granted, most applications will need interaction more complex then raw HTML. The main use case of Orbited is to send data that is interpreted by JavaScript. Then JavaScript can do the appropriate action based on the contents of the event. A good place to go from here is the <a href="cherrychat.html">CherryChat Tutorial</a>. It will show you how to weave Python, JavaScript, and Orbited together into a meaningful application.</p>
  </div>
</body>
</html>